@page "/notebookdetail/{NotebookId}"
@using ApexLM.Services
@using ApexLM.Components
@using MudBlazor
@inject NavigationManager Navigation
@inject ILayoutService LayoutService

<MudLayout>
    <!-- Mobile Header -->
    <MudAppBar Elevation="1" Class="d-lg-none">
        <MudIconButton Icon="Icons.Material.Filled.ArrowBack"
                       Color="Color.Inherit"
                       Edge="Edge.Start"
                       OnClick="GoBack" />
        <MudSpacer />
        <MudText Typo="Typo.h6" Class="text-truncate px-2">
            @currentNotebook?.Title
        </MudText>
        <MudSpacer />
        <MudIconButton Icon="Icons.Material.Filled.MoreVert"
                       Color="Color.Inherit"
                       Edge="Edge.End" />
    </MudAppBar>

    <MudMainContent>
        <div class="notebook-container">
            <!-- Mobile Tab Navigation -->
            <MudPaper Class="d-lg-none mobile-tabs" Elevation="0">
                <MudTabs @bind-ActivePanelIndex="mobileActiveTab" Color="Color.Primary" Centered="true">
                    <MudTabPanel Text="Sources">
                        <MudIcon Icon="@Icons.Material.Filled.Folder" Class="mr-2" />
                        Sources
                    </MudTabPanel>
                    <MudTabPanel Text="Chat">
                        <MudIcon Icon="@Icons.Material.Filled.Chat" Class="mr-2" />
                        Chat
                    </MudTabPanel>
                    <MudTabPanel Text="Studio">
                        <MudIcon Icon="@Icons.Material.Filled.AutoAwesome" Class="mr-2" />
                        Studio
                    </MudTabPanel>
                </MudTabs>
            </MudPaper>

            <!-- Three Pane Layout -->
            <div class="three-pane-container">
                <!-- Left Pane - Sources -->
                <div class="pane left-pane d-none d-lg-block">
                    <SourcePanel NotebookId="@NotebookId"
                                 SourceCount="@(currentNotebook?.SourceCount ?? 0)" />
                </div>

                <!-- Middle Pane - Chat -->
                <div class="pane middle-pane @(mobileActiveTab == 1 ? "d-block" : "d-lg-block")">
                    <ChatArea NotebookId="@NotebookId"
                              NotebookTitle="@currentNotebook?.Title" />
                </div>

                <!-- Right Pane - Studio -->
                <div class="pane right-pane d-none d-lg-block">
                    <StudioPanel NotebookId="@NotebookId" />
                </div>

                <!-- Mobile Panes -->
                <div class="d-lg-none mobile-panes">
                    @if (mobileActiveTab == 0)
                    {
                        <SourcePanel NotebookId="@NotebookId"
                                     SourceCount="@(currentNotebook?.SourceCount ?? 0)"
                                     IsMobile="true" />
                    }
                    else if (mobileActiveTab == 2)
                    {
                        <StudioPanel NotebookId="@NotebookId"
                                     IsMobile="true" />
                    }
                </div>
            </div>
        </div>
    </MudMainContent>
</MudLayout>

<style>
    /* Reset any default margins/padding */
    * {
        box-sizing: border-box;
    }

    .notebook-container {
        height: 85vh;       /*only this change remove scroll*/
        display: flex;
        flex-direction: column;
        overflow: hidden; /* Prevent outer scrolling */
    }

    .three-pane-container {
        display: flex;
        flex: 1;
        overflow: hidden; /* Prevent inner scrolling */
        height: 100%;
    }

    .pane {
        display: flex;
        flex-direction: column;
        overflow: hidden; /* Each pane controls its own overflow */
        border-right: 1px solid var(--mud-palette-lines-default);
    }

    .left-pane {
        width: 380px;
        min-width: 380px;
        flex-shrink: 0;
    }

    .middle-pane {
        flex: 1;
        min-width: 0;
    }

    .right-pane {
        width: 320px;
        min-width: 320px;
        flex-shrink: 0;
        border-right: none;
    }

    .mobile-tabs {
        flex-shrink: 0;
    }

    .mobile-panes {
        flex: 1;
        overflow: hidden;
    }

    /* Hide scrollbars but keep functionality */
    .pane {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
    }

        .pane::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

    /* Responsive adjustments */
    @@media (max-width: 1280px) {
        .left-pane {
            width: 340px;
            min-width: 340px;
        }

        .right-pane {
            width: 280px;
            min-width: 280px;
        }
    }

    @@media (max-width: 960px) {
        .three-pane-container {
            height: calc(100vh - 112px);
        }
    }
</style>